// Objs v.1.1, Roman Torshin, Apache 2.0 licence
const o=e=>{let t={els:[],ie:{}},n=0,s=1,i=2,l=3,r="object",a="function",c="dangerouslySetInnerHTML",d,f=document,h=-1,g=0,p=0,u=[],y=0,m=0,S=e=>typeof e,L=(e,t)=>{for(let n in e)Object.hasOwnProperty.call(e,n)&&t(n,e)},E=o.onError||(()=>{}),C=e=>(...r)=>{try{let a=e(r[n],r[s],r[i],r[l]);return a!==d?a:t}catch(c){E(c)}},$=e=>{for(y=g;y<=h;y++)e()},F=e=>(S(e)!==r&&(e=o.first(e).el),e),Z=(e=!0,i=t.els)=>{let l=i.length;t.length=l,h=l-s,g=n,t.el=l?i[n]:d,t.last=l?i[h]:d,e&&(L(u,(e,n)=>{delete t[n[e]]}),u=[],t.ie={})},v=(e="")=>Array.from(f.querySelectorAll(e));t.reset=o;let N=(e,t,s)=>{L(t,i=>{let l=t[i];S(l)===a&&(l=l(s)),"append"===i&&S(l)===r&&(l.els&&(l=[l]),l[n]&&l[n].els&&(valueBuff=[],L(l,e=>{valueBuff.push(...l[e].els)}),l=valueBuff)),l!==d&&(["tag","sample","state"].includes(i)||(["html","innerHTML"].includes(i)?e.innerHTML=l:"dataset"===i&&S(l)===r?L(l,t=>{e.dataset[t]=l[t]}):"toggleClass"===i?e.classList.toggle(l):"addClass"===i?S(l)===r?e.classList.add(...l):e.classList.add(l):"removeClass"===i?e.classList.remove(l):"style"===i&&S(l)===r?L(l,t=>{e.style[t]=l[t]}):"append"===i&&S(l)===r?L(l.length?l:[l],t=>{e.appendChild(l[t])}):e.setAttribute(i,l)))}),e.dataset.oState=t.state};return t.init=C(e=>{let i=t.initID||o.inits.length||n;t.initID=i,Z(),o.inits[t.initID]=t,(S(e)!==r||e.render===d)&&(e={render:e}),L(e,l=>{u.push(l),t[l]=C((c=[{}])=>{let p=e[l]||{tag:"div"},u=t.els.slice(g,h+s);S(p)===r&&(p.state=l,p["data-o-init"]=i);let L=(e,t={})=>S(p)===r?f.createElement(p.tag||"div"):((y=f.createElement("div")).innerHTML=S(p)===a?p(t):p,y.children.length>s||!y.firstElementChild)?(y.dataset.oInit=e,y):(y.firstElementChild.dataset.oInit=e,y.firstElementChild);c.length||(c=[c]);let E=!u[n]&&"render"===l;c=c.map((e,n)=>(e.self=t,e.o=o,e.i=e.i===d?n:e.i,E&&u.push(L(i,e)),e)),E&&(t.els=u,Z(!1)),u&&(m=u.length===c.length,u.map((e,t)=>{c[m?t:n].i=t+g;let s=S(p)===a?p(c[m?t:n]):p;S(s)===r&&N(e,s,c[m?t:n])}))})})}),t.initState=C((e,n)=>{t.init(e).render(n)}),t.sample=C((e="render")=>{let s=t.els[g].attributes,i=t.els[g].dataset,l={tag:t.els[g].tagName,html:t.els[g].innerHTML,dataset:{}};for(let r of s)"data-"!==r.nodeName.substring(n,5)&&(l[r.nodeName]=r.value);return L(i,e=>{l.dataset[e]=i[e]}),{[e]:l}}),t.select=C(e=>{e===d&&(e=t.length-s),h=e,g=e,t.el=t.els[e],p=s}),t.all=C(()=>{h=t.length-s,g=n,t.el=t.els[n],p=n}),t.remove=C(e=>{e===d&&p&&(e=g),e!==d?t.els[e].parentNode.removeChild(t.els[e]):$(()=>{t.els[y].parentNode.removeChild(t.els[y])}),Z(!1)}),t.skip=C(e=>{e===d&&(e=g),t.els.splice(y,s),Z()}),t.add=C((e,s)=>{"string"===S(e)&&""!==e?t.els.push(...v(e)):S(e)===r?e.tagName?t.els.push(e):e.els?t.els.push(...e.els):e.length&&e[n].tagName&&t.els.push(...e):"number"===S(e)&&o.inits[e]&&(t=o.inits[e]),Z(!1),t.initID!==d&&t.dataset({oInit:t.initID})}),t.appendInside=C(e=>{$(()=>{F(e).appendChild(t.els[y])})}),t.appendBefore=C(e=>{$(()=>{F(e).parentNode.insertBefore(t.els[y],F(e))})}),t.appendAfter=C(e=>{$(()=>{F(e).after(...t.els)})}),t.find=C((e="")=>{let n=[];return $(()=>{n.push(...Array.from(t.els[y].querySelectorAll(":scope "+e)))}),o(n)}),t.first=C((e="")=>{let n=d,s=[];return $(()=>{(n=t.els[y].querySelector(e))&&s.push(n)}),o(s)}),t.attr=C((e,s)=>{if(e){if(s===d){let i=[];return $(()=>{i[y]=t.els[y].getAttribute(e)}),p?i[n]:i}""!==s?$(()=>{t.els[y].setAttribute(e,s)}):$(()=>{t.els[y].removeAttribute(e)})}}),t.attrs=C(()=>{let e=[];return $(()=>{let n={};[...t.els[y].attributes].forEach(e=>{n[e.nodeName]=e.nodeValue}),e.push(n)}),p?e[n]:e}),t.dataset=C(e=>{if(typeof e===r)$(()=>{L(e,n=>{t.els[y].dataset[n]=e[n]})});else{let s=[];return $(()=>{s.push({...t.els[y].dataset})}),p?s[n]:s}}),t.style=C(e=>{t.attr("style",e)}),t.css=C((e={})=>{let n="";L(e,t=>{n+=t+":"+e[t].replace('"',"'")+";"}),t.style(n)}),t.setClass=C(e=>{$(()=>{t.els[y].setAttribute("class",e)})}),t.addClass=C(e=>{$(()=>{t.els[y].classList.add(e)})}),t.removeClass=C(e=>{$(()=>{t.els[y].classList.remove(e)})}),t.toggleClass=C((e,n)=>{$(()=>{t.els[y].classList.toggle(e,n)})}),t.haveClass=e=>{let n=!0;return $(()=>{t.els[y].classList.contains(e)||(n=!1)}),n},t.innerHTML=C(e=>{if(e!==d)$(()=>{t.els[y].innerHTML=e});else{let n="";return $(()=>{n+=t.els[y].innerHTML}),n}}),t.innerText=C((e="")=>{$(()=>{t.els[y].innerText=e})}),t.textContent=C((e="")=>{$(()=>{t.els[y].textContent=e})}),t.html=C(e=>{if(e)t.innerHTML(e);else{let n="";return $(()=>{n+=t.els[y].outerHTML}),n}}),t.forEach=C(e=>{$(()=>{e({self:t,i:y,o,el:t.els[y]})})}),t.prepareFor=C((e,i)=>{e.createElement&&(e=e.createElement);let l=()=>t.length===s?e(t.el.tagName.toLowerCase(),{...t.attrs()[n],[c]:{__html:t.innerHTML()}}):e("div",{[c]:{__html:t.html()}});return i?class extends i{render(){return l()}}:l()}),t.on=C((e,n,s,i)=>{e.split(", ").forEach(e=>{$(()=>{t.els[y].addEventListener(e,n,s,i)}),t.ie[e]||(t.ie[e]=[]),t.ie[e].push([n,s,i])})}),t.off=C((e,s,i)=>{e.split(", ").forEach(e=>{$(()=>{t.els[y].removeEventListener(e,s,i)}),t.ie[e]&&(t.ie[e]=t.ie[e].filter(e=>e[n]!==s))})}),t.onAll=C((e,l)=>{L(t.ie,(r,a)=>{e&&e!==r||a[r].forEach(e=>{$(()=>{l?t.els[y].removeEventListener(r,e[n]):t.els[y].addEventListener(r,e[n],e[s],e[i])})})})}),t.offAll=C(e=>{t.onAll(e,s)}),e&&t.add(e),t.take=e=>{if(t.add(e),t.el){let i=t.el.dataset.oInit;if(i!==d&&o.inits[i])return t.length===s?(m=t.els[n],Object.assign(t,o.inits[i]),t.els=[m]):t=o.inits[i],Z(!1,t.els),t}},t};o.first=e=>o(document.querySelector(e)||""),o.inits=[],o.errors=[],o.showErrors=!1,o.logErrors=()=>{o.errors.length?o.errors.forEach(e=>console.log(e)):console.log("No errors")},o.onError=e=>{o.showErrors?console.log(e):o.errors.push(e)},o.init=e=>o().init(e),o.initState=(e,t)=>o().init(e).render(t),o.take=e=>o().take(e),o.Z=0,o.N=1,o.W=2,o.H=100,o.F=!1,o.C=(e,t)=>Object.hasOwnProperty.call(e,t),o.ajax=(e,t={})=>{let n=new URLSearchParams;if(t.data&&"object"==typeof t.data){for(let s in t.data)o.C(t.data,s)&&("object"==typeof t.data[s]?n.set(s,encodeURIComponent(JSON.stringify(t.data[s]))):n.set(s,t.data[s]));"get"===t.method.toLowerCase()?e+="?"+n.toString():t.body||(t.body=n),delete t.data}return t.headers||(t.headers={"X-Requested-With":"XMLHttpRequest"}),fetch(e,t)},o.get=(e,t={})=>o.ajax(e,{...t,method:"GET"}),o.post=(e,t={})=>o.ajax(e,{...t,method:"POST"}),o.getParams=e=>{let t={},n=new URLSearchParams(window.location.search).entries();for(let s of n)t[s[o.Z]]=s[o.N];return e?t[e]:t},o.incCache=!0,o.incCacheExp=864e5,o.incTimeout=6e3,o.incSource="",o.incForce=o.F,o.incAsync=!0,o.incCors=o.F,o.incFns={},o.incSet=[o.Z],o.incReady=[o.Z],o.incN=o.Z,o.incCheck=(e=0,t,n=0)=>!n&&e&&t===o.U&&o.incReady[e]?o.incSet[e]===o.N:o.incReady[e]===o.U||o.incReady[e][t]===o.U?o.F:(o.incReady[e][t].loaded=n,o.incFns[o.incReady[e][t].name]=n,o.incReady[e][o.Z]+=n,e&&o.incReady[e].length===o.incReady[e][o.Z]&&("function"==typeof o.incSet[e]&&o.incSet[e](e),o.incSet[e]=o.N),o.incSet[e]===o.N),o.incCacheClear=(e=o.F)=>{for(let t in o.incFns)o.C(o.incFns,t)&&(localStorage.removeItem("inc-"+t),localStorage.removeItem("inc-"+t+"Expires"));return e&&(o.incReady.forEach((e,t)=>{t&&e.forEach((e,n)=>{n&&o("#oInc-"+t+"-"+n).remove()})}),o.incN=o.Z,o.incFns={},o.incSet=[o.Z],o.incReady=[o.Z]),!0},o.inc=(e,t,n)=>{let s=o.Z,i=o.Z,l="function";if("object"!=typeof e||!e)return o.incSet[o.Z];o.incSet[o.Z]++;let r=o.incSet[o.Z];o.incSet[r]=t||o.Z,o.incReady[r]=[];let a=o.incReady[r];a[o.Z]=o.N;let c={};for(let d in e)if(o.C(e,d)){s++,o.incN++;let f=e[d].indexOf(".css")>-1?"style":"script";if(e[d]=(o.incSource?o.incSource+"/":"")+e[d],isNaN(d)&&o.C(o.incFns,d)&&o.incFns[d]&&!o.incForce){a[s]={name:d,loaded:o.N},i++;continue}if(a[s]={name:d,loaded:o.Z},isNaN(d)&&(o.incFns[d]=o.Z),isNaN(d)&&o.incCache&&"http"!==e[d].substring(o.Z,4)&&"file:"!==window.location.protocol&&(e[d].indexOf(".css")>-1||e[d].indexOf(".js")>-1)){let h=localStorage,g=h.getItem("inc-"+d),p=h.getItem("inc-"+d+"Expires");g&&p&&new Date().getTime()<p?(o.initState({tag:f,id:"oInc-"+r+"-"+s,innerHTML:g,"data-o-inc":r}).appendInside("head"),a[s].loaded=o.N,o.incFns[d]=o.N,i++):(c[d]=s,o.get(e[d],{mode:o.incCors?"cors":"same-origin"}).then(t=>{if(200!==t.status){o.onError&&o.onError({message:o.incSource+e[d]+" was not loaded"});return}t.text().then(e=>{h.setItem("inc-"+d,e),h.setItem("inc-"+d+"Expires",new Date().getTime()+o.incCacheExp),o.initState({tag:f,id:"oInc-"+r+"-"+c[d],innerHTML:e,"data-o-inc":r}).appendInside("head"),o.incCheck(r,c[d],o.N)})}))}else{let u={tag:f,id:"oInc-"+r+"-"+s,"data-o-inc":r,async:o.incAsync,onload:"o.incCheck("+r+","+s+",1)"};e[d].indexOf(".css")>-1?(u.tag="link",u.rel="stylesheet",u.href=e[d]):(e[d].indexOf(".js")>-1||(u.tag="img",u.style="display:none;"),u.src=e[d]),o.initState(u).appendInside(u.style?"body":"head")}}return a[o.Z]+=i,s!==o.Z&&(i===s?typeof t===l&&t(r):setTimeout(e=>{o.incReady[e]&&o.incReady[e].length<o.incReady[e][o.Z]&&(o.incSet[e]=o.Z,typeof n===l&&n(r))},o.incTimeout,r)),o.incSet[o.Z]},o.tLog=[],o.tRes=[],o.tStatus=[],o.tFns=[],o.tShowOk=o.F,o.tStyled=o.F,o.tTime=2e3,o.tPre='<div style="font-family:monospace;text-align:left;">',o.tOk='<span style="background:#cfc;padding: 0 15px;">OK</span> ',o.tXx='<div style="background:#fcc;padding:3px;">',o.tDc="</div>",o.test=(e="",...t)=>{let n=o.tLog.length,s=0,i="├ OK: ",l="├ ✘ ",r="\n",a="\n",c=t.length,d=o.Z;"function"==typeof t[c-o.N]&&(o.tFns[n]=t[c-o.N],c--),o.tStyled?(o.tLog[n]="<div><b>"+e+" #"+n+"</b></div>",i=o.tPre+o.tOk,l=o.tPre+o.tXx,a=(r=o.tDc)+r):o.tLog[n]=e+" #"+n+"\n",o.tRes[n]=o.F,o.tStatus[n]=[];for(let f=o.Z;f<c;f++){let h={n:n,i:f,title:t[f][o.Z],tShowOk:o.tShowOk,tStyled:o.tStyled},g=t[f][o.N];if("function"==typeof g)try{g=g(h)}catch(p){g=p.message,o.onError&&o.onError(p)}o.tStatus[n][f]="string"==typeof g?o.F:g,!0===g?(d++,o.tShowOk&&(o.tLog[n]+=i+t[f][o.Z]+r)):g!==o.U?o.tLog[n]+=l+t[f][o.Z]+(g!==o.F?": <i>"+g+"</i>":"")+a:(s++,setTimeout(e=>{e.title+=" (timeout)",o.testUpdate(e)},o.tTime,h))}return o.tRes[n]=d===c,o.tStyled?o.tLog[n]+=o.tPre+'<div style="color:'+(d+s!==c?"red":"green")+';"><b>':o.tLog[n]+=s?"├":"└ ",o.tLog[n]+="DONE "+d+"/"+(c-s),s&&(o.tLog[n]+=", waiting: "+s),o.tStyled?o.tLog[n]+="</b>"+o.tDc+o.tDc:o.tLog[n]+="\n",s||"function"!=typeof o.tFns[n]||o.tFns[n](n),n},o.testUpdate=(e,t=o.F,n="")=>{if(o.tStatus[e.n][e.i]===o.U){o.tStatus[e.n][e.i]=!0===t,!0===t?e.tShowOk&&(e.tStyled?o.tLog[e.n]+=o.tPre+o.tOk+e.title+n+o.tDc:o.tLog[e.n]+="└ OK: "+e.title+n+"\n"):(o.tRes[e.n]=o.F,e.tStyled?o.tLog[e.n]+=o.tPre+o.tXx+e.title+n+(t?": "+t:"")+o.tDc+o.tDc:o.tLog[e.n]+="└ ✘ "+e.title+(t?": "+t:"")+n+"\n");let s=o.Z,i=s;for(let l of o.tStatus[e.n]){if(l===o.U)return;!l&&s++,i++}o.tRes[e.n]=!s;let r=s?"FAILED "+s+"/"+i:"DONE "+i+"/"+i;e.tStyled?o.tLog[e.n]+=o.tPre+'<b style="color:'+(s?"red":"green")+';">'+r+"</b>"+o.tDc:o.tLog[e.n]+="└ "+r,"function"==typeof o.tFns[e.n]&&o.tFns[e.n](e.n)}};
